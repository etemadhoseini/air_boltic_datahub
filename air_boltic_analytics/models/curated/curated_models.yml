version: 2

models:
  - name: dim_airplane
    description: Type 1 airplane dimension joined with canonical model attributes.
    columns:
      - name: airplane_id
        description: Natural key from source
        data_type: integer
        tests: [not_null, unique]
      - name: manufacturer
        data_type: string
        tests: [not_null]
      - name: model
        data_type: string
        tests: [not_null]
      - name: max_seats
        data_type: int
      - name: engine_type
        data_type: string
      - name: max_distance
        data_type: int
      - name: max_weight
        data_type: int
      - name: model_key
        data_type: string

  - name: dim_customer
    description: Type 1 customer dimension enriched with group attributes.
    columns:
      - name: customer_id
        description: Natural key from source
        data_type: integer
        tests: [not_null, unique]
      - name: customer_group_id
        data_type: integer
      - name: customer_group_name
        data_type: string
      - name: customer_group_type
        data_type: string
      - name: customer_group_registry_number
        data_type: string
      - name: customer_name
        data_type: string
        tests: [not_null]

  - name: fct_orders
    description: Incremental fact of orders with trip attributes; handles late-arriving data via updated_at from staging.
    columns:
      - name: order_id
        data_type: integer
        tests: [not_null, unique]
      - name: customer_id
        data_type: integer
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id
      - name: trip_id
        data_type: integer
      - name: airplane_id
        data_type: integer
      - name: order_status
        data_type: string
        tests:
          - relationships:
              arguments:
                  to: ref('reference__order_status')
                  field: status
                  config:
                    severity: warn
      - name: price_eur
        data_type: decimal(18,2)
        tests: [not_null]
      - name: seat_no
        data_type: string
      - name: origin_city
        data_type: string
      - name: destination_city
        data_type: string
      - name: trip_start_ts
        data_type: timestamp
      - name: trip_end_ts
        data_type: timestamp
      - name: order_trip_start_ts
        data_type: timestamp
      - name: order_trip_start_date
        data_type: date
      - name: trip_duration_minutes
        data_type: double
      - name: updated_at
        description: Latest change timestamp from order/trip used to drive incremental loads
        data_type: timestamp
        tests: [not_null]
